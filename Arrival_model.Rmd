Model Arrival Variation
========================================================

This document describes the model of Arrival/catch observed in Arizona and how it covaries with energetic demand and resource availability in Mexican wintering grounds

```{r}
#load the Hummingbird arrival data; i.e. the d.f. yearly.catch.stat
load("C:/Users/sarah/Dropbox/ActiveResearchProjects/Hummingbird_extreme_limits/yearly.catch.stat.rdata")
```

```{r}
#Calculate quantiles of arrival distribution per site & year ('sess.quant...'). quant.50 indicates the median arrival date at a given site and year.
yearly.catch.stat$sess.quant.05 <- as.Date(yearly.catch.stat$sess.quant.05, origin="2015-01-01")
yearly.catch.stat$sess.quant.25 <- as.Date(yearly.catch.stat$sess.quant.25, origin="2015-01-01")
yearly.catch.stat$sess.quant.50 <- as.Date(yearly.catch.stat$sess.quant.50, origin="2015-01-01")
yearly.catch.stat$sess.quant.75 <- as.Date(yearly.catch.stat$sess.quant.75, origin="2015-01-01")
yearly.catch.stat$sess.quant.95 <- as.Date(yearly.catch.stat$sess.quant.95, origin="2015-01-01")
#note that in the sess.quant variables the year is irrelevant
````

Load the yearly climate (and NDVI) data which will serve as predictors and merge it with the arrival/catch metrics in the data frame 'yearly.catch.stat' to be used for modelling
````{r}
load("C:/Users/sarah/Dropbox/ActiveResearchProjects/Hummingbird_extreme_limits/yearly.climate.rdata")
#gives you yearly.climate
yearly.catch.stat <- merge(yearly.catch.stat, yearly.climate)
````

Plot relationship of NDVI with precipitation
```{r}
require(ggplot2)

ggplot(yearly.climate, aes(wintercumpre, winterNDVI)) + geom_point() + stat_smooth(method="lm") + 
  ylab("average winter NDVI") + xlab("cumulative winter precip (mm)") + #geom_text(aes(label=yr)) +
  theme_classic() + theme(text = element_text(size=20))
lm1 = lm(winterNDVI ~ wintercumpre, data = yearly.climate)
print(summary(lm1)$r.sq)

rm(yearly.climate)
```

Plot arrival responses to a proxy for physiological (yearly.Te.10C.q) demand and resrouce availability (NDVI)
```{r fig.width=7, fig.height=6, warning=FALSE}
require(lattice)
require(latticeExtra)
xyplot(sess.quant.50 ~ yearly.Te.10C.q|LOC, data=yearly.catch.stat) + layer(panel.smoother(x, y, method = "lm"))
xyplot(sess.quant.50 ~ winterNDVI|LOC, data=yearly.catch.stat) + layer(panel.smoother(x, y, method = "lm"))
```

Load a function ('mod.evaluation') to evaluate hierarchical models
````{r}
source('/Users/sarah/Documents/GitHub/extreme_limits/Model_evaluation_v4.r')
````

Using aforementioned function evaluate hierarchical models of median arrival as a linear function of annual physiological demand and resource availability, allowing for a random intercept associated with 'site' 
````{r}
attach(yearly.catch.stat)
#http://www.quantpsy.org/interact/interactions.htm
mod.evaluation(yname='sess.quant.50',centering='CGM',stand=T,log.D=T,R="winterNDVI") 
detach(yearly.catch.stat)
````

Using  function evaluate hierarchical models of 25th percentile arrival as a linear function of annual physiological demand and resource availability, allowing for a random intercept associated with 'site' 
````{r}
attach(yearly.catch.stat)
#http://www.quantpsy.org/interact/interactions.htm
mod.evaluation(yname='sess.quant.25',centering='CGM',stand=T,log.D=T,R="winterNDVI") 
detach(yearly.catch.stat)
````